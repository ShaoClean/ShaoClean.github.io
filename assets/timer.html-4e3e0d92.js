const n=JSON.parse('{"key":"v-c0c2884a","path":"/study/frontend/vue/timer.html","title":"缓存计时器","lang":"zh-CN","frontmatter":{"icon":"vue","date":"2023-02-28T00:00:00.000Z","category":["前端","Vue"],"tag":["学习笔记"],"description":"缓存计时器 &lt;template&gt; \\t&lt;button @click=\\"change\\" :disabled=\\"isDisabled\\"&gt;{{ btnMsg }}&lt;/button&gt; &lt;/template&gt; &lt;script&gt; // t0 = 计时器时间 // t1 = 按下计时器时的时间戳 // t2 = 当前时间戳 // t3 = 剩余时间 = t0 - (t2 - t1) const isDisabled = ref(false); const btnMsg = ref(\\"im button !\\"); const t0 = ref(30); const t1 = ref(); const t2 = ref(); const t3 = ref(); let timer; let timeStamp = parseInt(localStorage.getItem(\\"timeStamp\\")); if (timeStamp) { \\tt1.value = timeStamp; \\tif (Date.now() / 1000 - t1.value &lt; t0.value) { \\t\\t//页面刷新时，计时器将任务加入到消息队列中存在一定的时间差异，需要通过同步任务的方式再计算一遍 \\t\\tbtnMsg.value = `waiting ${parseInt( \\t\\t\\tt0.value - (Date.now() / 1000 - t1.value) \\t\\t)}s...`; \\t\\tbeginTimer(); \\t} } function change() { \\tt1.value = Math.ceil(Date.now() / 1000); \\tlocalStorage.setItem(\\"timeStamp\\", t1.value); \\tbtnMsg.value = `waiting ${t0.value}s...`; \\tbeginTimer(); } function beginTimer() { \\tisDisabled.value = true; \\ttimer = setInterval(() =&gt; { \\t\\tt2.value = Date.now() / 1000; \\t\\tt3.value = parseInt(t0.value - (t2.value - t1.value)); \\t\\tbtnMsg.value = `waiting ${t3.value}s...`; \\t}, 1000); } watch(t3, val =&gt; { \\tif (val &lt;= 0) { \\t\\tisDisabled.value = false; \\t\\tbtnMsg.value = \\"im button!\\"; \\t\\tclearInterval(timer); \\t} }); &lt;/script&gt;","head":[["meta",{"property":"og:url","content":"https://doc.shaoclean.top/study/frontend/vue/timer.html"}],["meta",{"property":"og:site_name","content":"clog"}],["meta",{"property":"og:title","content":"缓存计时器"}],["meta",{"property":"og:description","content":"缓存计时器 &lt;template&gt; \\t&lt;button @click=\\"change\\" :disabled=\\"isDisabled\\"&gt;{{ btnMsg }}&lt;/button&gt; &lt;/template&gt; &lt;script&gt; // t0 = 计时器时间 // t1 = 按下计时器时的时间戳 // t2 = 当前时间戳 // t3 = 剩余时间 = t0 - (t2 - t1) const isDisabled = ref(false); const btnMsg = ref(\\"im button !\\"); const t0 = ref(30); const t1 = ref(); const t2 = ref(); const t3 = ref(); let timer; let timeStamp = parseInt(localStorage.getItem(\\"timeStamp\\")); if (timeStamp) { \\tt1.value = timeStamp; \\tif (Date.now() / 1000 - t1.value &lt; t0.value) { \\t\\t//页面刷新时，计时器将任务加入到消息队列中存在一定的时间差异，需要通过同步任务的方式再计算一遍 \\t\\tbtnMsg.value = `waiting ${parseInt( \\t\\t\\tt0.value - (Date.now() / 1000 - t1.value) \\t\\t)}s...`; \\t\\tbeginTimer(); \\t} } function change() { \\tt1.value = Math.ceil(Date.now() / 1000); \\tlocalStorage.setItem(\\"timeStamp\\", t1.value); \\tbtnMsg.value = `waiting ${t0.value}s...`; \\tbeginTimer(); } function beginTimer() { \\tisDisabled.value = true; \\ttimer = setInterval(() =&gt; { \\t\\tt2.value = Date.now() / 1000; \\t\\tt3.value = parseInt(t0.value - (t2.value - t1.value)); \\t\\tbtnMsg.value = `waiting ${t3.value}s...`; \\t}, 1000); } watch(t3, val =&gt; { \\tif (val &lt;= 0) { \\t\\tisDisabled.value = false; \\t\\tbtnMsg.value = \\"im button!\\"; \\t\\tclearInterval(timer); \\t} }); &lt;/script&gt;"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-02-28T00:44:21.000Z"}],["meta",{"property":"article:tag","content":"学习笔记"}],["meta",{"property":"article:published_time","content":"2023-02-28T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-02-28T00:44:21.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"缓存计时器\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-02-28T00:00:00.000Z\\",\\"dateModified\\":\\"2023-02-28T00:44:21.000Z\\",\\"author\\":[]}"]]},"headers":[],"git":{"createdTime":1677511288000,"updatedTime":1677545061000,"contributors":[{"name":"clean","email":"1518136109@qq.com","commits":2}]},"readingTime":{"minutes":0.67,"words":202},"filePathRelative":"study/frontend/vue/timer.md","localizedDate":"2023年2月28日","excerpt":"<h1> 缓存计时器</h1>\\n<div class=\\"language-vue line-numbers-mode\\" data-ext=\\"vue\\"><pre class=\\"language-vue\\"><code><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>template</span><span class=\\"token punctuation\\">&gt;</span></span>\\n\\t<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>button</span> <span class=\\"token attr-name\\">@click</span><span class=\\"token attr-value\\"><span class=\\"token punctuation attr-equals\\">=</span><span class=\\"token punctuation\\">\\"</span>change<span class=\\"token punctuation\\">\\"</span></span> <span class=\\"token attr-name\\">:disabled</span><span class=\\"token attr-value\\"><span class=\\"token punctuation attr-equals\\">=</span><span class=\\"token punctuation\\">\\"</span>isDisabled<span class=\\"token punctuation\\">\\"</span></span><span class=\\"token punctuation\\">&gt;</span></span>{{ btnMsg }}<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>button</span><span class=\\"token punctuation\\">&gt;</span></span>\\n<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>template</span><span class=\\"token punctuation\\">&gt;</span></span>\\n<span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>script</span><span class=\\"token punctuation\\">&gt;</span></span><span class=\\"token script\\"><span class=\\"token language-javascript\\">\\n<span class=\\"token comment\\">// t0 = 计时器时间</span>\\n<span class=\\"token comment\\">// t1 = 按下计时器时的时间戳</span>\\n<span class=\\"token comment\\">// t2 = 当前时间戳</span>\\n<span class=\\"token comment\\">// t3 = 剩余时间 = t0 - (t2 - t1)</span>\\n<span class=\\"token keyword\\">const</span> isDisabled <span class=\\"token operator\\">=</span> <span class=\\"token function\\">ref</span><span class=\\"token punctuation\\">(</span><span class=\\"token boolean\\">false</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">const</span> btnMsg <span class=\\"token operator\\">=</span> <span class=\\"token function\\">ref</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"im button !\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">const</span> t0 <span class=\\"token operator\\">=</span> <span class=\\"token function\\">ref</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">30</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">const</span> t1 <span class=\\"token operator\\">=</span> <span class=\\"token function\\">ref</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">const</span> t2 <span class=\\"token operator\\">=</span> <span class=\\"token function\\">ref</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">const</span> t3 <span class=\\"token operator\\">=</span> <span class=\\"token function\\">ref</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">let</span> timer<span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">let</span> timeStamp <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parseInt</span><span class=\\"token punctuation\\">(</span>localStorage<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getItem</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"timeStamp\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>timeStamp<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n\\tt1<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> timeStamp<span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>Date<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">now</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span> <span class=\\"token operator\\">-</span> t1<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">&lt;</span> t0<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n\\t\\t<span class=\\"token comment\\">//页面刷新时，计时器将任务加入到消息队列中存在一定的时间差异，需要通过同步任务的方式再计算一遍</span>\\n\\t\\tbtnMsg<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">`</span><span class=\\"token string\\">waiting </span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">${</span><span class=\\"token function\\">parseInt</span><span class=\\"token punctuation\\">(</span>\\n\\t\\t\\tt0<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">-</span> <span class=\\"token punctuation\\">(</span>Date<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">now</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span> <span class=\\"token operator\\">-</span> t1<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span>\\n\\t\\t<span class=\\"token punctuation\\">)</span><span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">s...</span><span class=\\"token template-punctuation string\\">`</span></span><span class=\\"token punctuation\\">;</span>\\n\\t\\t<span class=\\"token function\\">beginTimer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">change</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n\\tt1<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> Math<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ceil</span><span class=\\"token punctuation\\">(</span>Date<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">now</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\tlocalStorage<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setItem</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"timeStamp\\"</span><span class=\\"token punctuation\\">,</span> t1<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\tbtnMsg<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">`</span><span class=\\"token string\\">waiting </span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">${</span>t0<span class=\\"token punctuation\\">.</span>value<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">s...</span><span class=\\"token template-punctuation string\\">`</span></span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token function\\">beginTimer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">beginTimer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n\\tisDisabled<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">;</span>\\n\\ttimer <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setInterval</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n\\t\\tt2<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> Date<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">now</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">;</span>\\n\\t\\tt3<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parseInt</span><span class=\\"token punctuation\\">(</span>t0<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">-</span> <span class=\\"token punctuation\\">(</span>t2<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">-</span> t1<span class=\\"token punctuation\\">.</span>value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\t\\tbtnMsg<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">`</span><span class=\\"token string\\">waiting </span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">${</span>t3<span class=\\"token punctuation\\">.</span>value<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">s...</span><span class=\\"token template-punctuation string\\">`</span></span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token function\\">watch</span><span class=\\"token punctuation\\">(</span>t3<span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">val</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n\\t<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>val <span class=\\"token operator\\">&lt;=</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n\\t\\tisDisabled<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token boolean\\">false</span><span class=\\"token punctuation\\">;</span>\\n\\t\\tbtnMsg<span class=\\"token punctuation\\">.</span>value <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"im button!\\"</span><span class=\\"token punctuation\\">;</span>\\n\\t\\t<span class=\\"token function\\">clearInterval</span><span class=\\"token punctuation\\">(</span>timer<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\t<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n</span></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>script</span><span class=\\"token punctuation\\">&gt;</span></span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{n as data};
