import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,d as p}from"./app.b2387096.js";const t={},e=p(`<h1 id="session-demo" tabindex="-1"><a class="header-anchor" href="#session-demo" aria-hidden="true">#</a> session demo</h1><p>\u4F7F\u7528\u4E4B\u524D\u9700\u8981\u5B89\u88C5\u7684\u4F9D\u8D56\uFF1A</p><ul><li>npm i express</li><li>npm i express-session</li><li>npm i body-parser</li><li>npm i cors</li></ul><h1 id="\u5B8C\u6574\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#\u5B8C\u6574\u4EE3\u7801" aria-hidden="true">#</a> \u5B8C\u6574\u4EE3\u7801</h1><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express-session&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;body-parser&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u4E00\u4E2A String \u7C7B\u578B\u7684\u5B57\u7B26\u4E32\uFF0C\u4F5C\u4E3A\u670D\u52A1\u5668\u7AEF\u751F\u6210 session \u7684\u7B7E\u540D\u3002</span>
        <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">&quot;Shh, its a secret!&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">//\u8FD4\u56DE\u5BA2\u6237\u7AEF\u7684 key \u7684\u540D\u79F0\uFF0C\u9ED8\u8BA4\u4E3A connect.sid,\u4E5F\u53EF\u4EE5\u81EA\u5DF1\u8BBE\u7F6E\u3002</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;login-status&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">//\u5F3A\u5236\u4FDD\u5B58 session \u5373\u4F7F\u5B83\u5E76\u6CA1\u6709\u53D8\u5316\u3002\u9ED8\u8BA4\u4E3A true\u3002\u5EFA\u8BAE\u8BBE\u7F6E\u6210 false\u3002</span>
        <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">//\u5F3A\u5236\u5C06\u672A\u521D\u59CB\u5316\u7684 session \u5B58\u50A8\u3002</span>
        <span class="token comment">//\u5F53\u65B0\u5EFA\u4E86\u4E00\u4E2A session \u4E14\u672A\u8BBE\u5B9A\u5C5E\u6027\u6216\u503C\u65F6\uFF0C\u5B83\u5C31\u5904\u4E8E\u672A\u521D\u59CB\u5316\u72B6\u6001\u3002</span>
        <span class="token comment">//\u5728\u8BBE\u5B9A\u4E00\u4E2A cookie \u524D\uFF0C\u8FD9\u5BF9\u4E8E\u767B\u9646\u9A8C\u8BC1\uFF0C\u51CF\u8F7B\u670D\u52A1\u7AEF\u5B58\u50A8\u538B\u529B\uFF0C\u6743\u9650\u63A7\u5236\u662F\u6709\u5E2E\u52A9\u7684\u3002(\u9ED8 \u8BA4:true)\u3002\u5EFA\u8BAE\u624B\u52A8\u6DFB\u52A0\u3002</span>
        <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">//\u8BBE\u7F6E\u8FD4\u56DE\u5230\u524D\u7AEF key \u7684\u5C5E\u6027\uFF0C\u9ED8\u8BA4\u503C\u4E3A{ path: \u2018/\u2019, httpOnly: true, secure: false, maxAge: null }\u3002</span>
        <span class="token literal-property property">cookie</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token comment">// maxAge:3000,</span>
            <span class="token comment">// secure:true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">//\u5728\u6BCF\u6B21\u8BF7\u6C42\u65F6\u5F3A\u884C\u8BBE\u7F6E cookie\uFF0C\u8FD9\u5C06\u91CD\u7F6E cookie \u8FC7\u671F\u65F6\u95F4(\u9ED8\u8BA4:false)</span>
        <span class="token literal-property property">rolling</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u914D\u7F6E\u8BF7\u6C42\u6E90</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Origin&#39;</span><span class="token punctuation">,</span>  <span class="token string">&#39;http://localhost:5173&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Headers&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Content-Type, Content-Length, Authorization, Accept, X-Requested-With&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5141\u8BB8\u643A\u5E26\u9A8C\u8BC1\u4FE1\u606F</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Credentials&#39;</span><span class="token punctuation">,</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5141\u8BB8\u8BF7\u6C42\u65B9\u6CD5</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Methods&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;PUT, POST, GET, DELETE, OPTIONS&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">&#39;OPTIONS&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5F15\u5165body-parser,\u5426\u5219\u4E0D\u80FD\u83B7\u53D6\u7528\u6237\u7AEF\u4F20\u9012\u8FC7\u6765\u7684\u6570\u636E</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/check&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;loginStatus&quot;</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>session<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>loginStatus <span class="token operator">===</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">info</span><span class="token operator">:</span><span class="token string">&quot;check pass!&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">session</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">info</span><span class="token operator">:</span><span class="token string">&quot;error session!&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">session</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>account<span class="token punctuation">,</span>psw<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>account <span class="token operator">===</span> <span class="token string">&quot;1&quot;</span> <span class="token operator">&amp;&amp;</span> psw <span class="token operator">===</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        req<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&quot;loginStatus&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;success&quot;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;login success session:&quot;</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&quot;loginStatus&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token literal-property property">info</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;clean&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">money</span><span class="token operator">:</span><span class="token string">&quot;199w&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">session</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">info</span><span class="token operator">:</span><span class="token string">&quot;error info!&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">session</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;listening on *:4000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),o=[e];function c(l,i){return s(),a("div",null,o)}const k=n(t,[["render",c],["__file","session-demo.html.vue"]]);export{k as default};
