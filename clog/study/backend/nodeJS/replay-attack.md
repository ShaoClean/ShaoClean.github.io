---
icon: nodeJS
date: 2022-10-11
star: 10
category:
  - 后端
  - Node
tag:
  - 接口重放攻击
  - 学习笔记
---

# 接口重放攻击

# 什么是接口重放

>重放攻击(Replay Attacks)又称重播攻击、回放攻击，是指攻击者发送一个目的主机已接收过的包，来达到欺骗系统的目的，主要用于身份认证过程，破坏认证的正确性。
>重放攻击可以由发起者，也可以由拦截并重发该数据的敌方进行。攻击者利用网络监听或者其他方式盗取认证凭据，之后再把它重新发给认证服务器。
>重放攻击在任何网络通信过程中都可能发生，是计算机世界黑客常用的攻击方式之一。

# 复现

具体思路：
- 通过抓包工具（Charles）获取到请求后台的接口信息
- 修改请求的接口参数
- 完成接口重放攻击 

点击[这里](../../../demo/replay-attact-demo.md)查看具体代码示例

# 防止接口重放

## timestamps

timestamp 用来表示请求的当前时间戳，这个时间戳当然要和服务器时间戳进行校正过的。我们预期正常请求带的 timestamp 参数会是不同的（预期是正常的人每秒至多只会做一个操作）。每个请求带的时间戳不能和当前时间超过一定规定的时间。比如 60s。这样，这个请求即使被截取了，你也只能在 60s 内进行重放攻击。过期失效。



## nonce
Nonce是Number once的缩写

是由客户端根据足够随机的情况生成的，比如 md5 (timestamp+rand (0, 1000)); 它就有一个要求，正常情况下，在短时间内（比如 60s）连续生成两个相同 nonce 的情况几乎为 0。

服务端第一次在接收到这个 nonce 的时候做下面行为：
- 去 redis 中查找是否有 key 为 nonce:{nonce} 的 string
- 如果没有，则创建这个 key，把这个 key 失效的时间和验证 timestamp 失效的时间一致，比如是 60s。
- 如果有，说明这个 key 在 60s 内已经被使用了，那么这个请求就可以判断为重放请求。

Nonce是一个在加密通信只能使用一次的数字。在认证协议中，它往往是一个随机或伪随机数，以避免重放攻击。Nonce也用于流密码以确保安全。如果需要使用相同的密钥加密一个以上的消息，就需要Nonce来确保不同的消息与该密钥加密的密钥流不同。


## timestamps+nonce

服务端接到这个请求：
- 先验证 sign 签名是否合理，证明请求参数没有被中途篡改
- 再验证 timestamp 是否过期，证明请求是在最近 60s 被发出的
- 最后验证 nonce 是否已经有了，证明这个请求不是 60s 内的重放请求